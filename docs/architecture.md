# Архитектура

## Основа

За основу взята архитектура [FSD](https://feature-sliced.github.io/documentation/ru/docs/get-started/overview).

Далее будут различные уточнения и изменения FSD, специфичные для проекта.

## Структура папок

### Слои

Проект делится на стандартные для FSD слои:

- app
- pages
- widgets
- features
- entities
- shared

Каждый слой внутри делится на группы слайсов.

**Примеры:**

- profile-group - содержит в себе все слайсы относящие к профилю плользователя
  (данные о пользователе, его заказы, корзина и тд.).

#### Entities

Слой, в котором располагаются слайсы, отвечающие за отдельные небольшие кусочки приложения.
Как правило entities отвечают за загрузку, хранение и/или отображение данных отдельной небольшой
сущности приложения.

**Могут:**

- делать запросы к backend-у для получения своих данных;
- хранить свои данные в своем отдельном store;
- рисовать свой ui (в том числе в свой ui они могут выводить данные из своего store).

**Не могут:**

- использовать или реализовывать любые функции для выполнения функций приложения (бизнес процессов).

**Примеры:**

- карточка продукта ресторана;
- информация об авторизованном пользователе.

#### Features

Слой, в котором располагаются слайсы, отвечающие за отдельные функции приложения
(речь не про функции в коде, а именно про функции самого приложения - бизнес процессы).

**Могут:**

- делать запросы к backend-у для выполнения различных функций и процессов на стороне сервера;
- получать данные из различных entities для выполнения манипуляций с ними;
- использовать функции у entities для изменения store;
- рисовать свой ui (в том числе в свой ui они могут выводить данные из различных entities,
  однако важно отметить, что ui у features часто либо отсутствует, либо является простым контролом,
  который запускает выполнение логики из сегмента model этой feature);
- использовать или реализовывать любые функции для выполнения функций приложения (бизнес процессов).

**Не могут:**

- хранить свои данные в своем store и/или использовать или реализовывать различные action-ы в своем store;

**Примеры:**

- создана заказа;
- работа с корзиной пользователя (добавление/удаление/очистка).

#### Widgets

Слой, в котором располагаются слайсы больших разделов страницы.
Как правило widget выполняет роль группировки набора entities и features, относящихся к одному
и тому же разделу страницы, а также размещает их в нужных местах разметки.
Своей логики и кода у widget-а должно быть минимум.

**Примеры:**

- меню авторизованного пользователя;
- список ресторанов и блюд.

#### Pages

Слой, в котором располагаются слайсы целых страниц.
Как правило они импортируют различные entities, features и widgets, которые далее размещают
в нужных местах разметки страницы.
Своей логики и кода у них должно быть минимум.

**Примеры:**

- страница ресторанов / блюд / оформления заказа.

#### App

Слой, в котором находятся родительский компонент, настройка и подключение провайдеров,
общий layout приложения, настройка router-а и подобное.

#### Shared

Слой, в котором находятся различные универсальные, непривязанные к каким-то
конкретным кускам приложения, библиотеки, общие типы, глобальные константы, конфиги и подобное.

**Важно:**

В слое shared на самом деле нет слайсов.
Там вместо слайсов находятся shared библиотеки, которые по смыслу и структуре почти ничем не отличаются от слайсов.
Единственное их отличие заключается в том, что слайсы - это отдельные сущности/кусочки приложения,
тогда как shared библиотеки - это независимые модули, непривязанные к конкретному месту приложения или сущности.

#### Сегменты слайса

В слайсе или shared библиотеке могут быть следующие сегменты:

- ui - для React компонентов, функций рендера ui и хуков рендера ui;
  - файлы с компонентами;
  - файлы со стилями;
  - файлы со stories для storybook-а;
  - файлы с функциями для рендера ui (пример: create-table-columns.tsx);
  - файлы с хуками для рендера ui;
  - папки для группировки файлов
    (обычно к одному компоненту относятся сразу несколько файлов,
    которые стоит объединить в папку с аналогичным названием,
    но в папки можно объединять и что-то другое (пример: папка для папок компонентов));
- папка utils - для утилит и утилитарных хуков;
  - файлы с утилитами;
  - файлы с утилитарными хуками;
  - папки для группировки файлов;
- папка constants - для констант;
  - файлы с константами;
  - папки для группировки файлов;
- model - для любой бизнес логики (как правило работа со store);
  - файлы с функциями для бизнес логики;
  - файлы с хуками для бизнес логики;
  - папки для группировки файлов;
- api - для реализации функций с запросами;
  - файлы с функциями запросов
    (внутри могут также быть небольшие функции преобразования dto в клиентские типы);
  - файлы с большими функциями преобразования dto в клиентские типы;
  - папки для группировки файлов;
- types - для всех типов слайса или типов shared библиотеки;
  - файлы с типами;
  - папки для группировки файлов;
  - index файл для реэкспорта типов.

**Важно:**

У различных компонентов, функций и хуков могут быть тесты.
Они должны располагаться в виде файла рядом с тем, что они тестируют.
Название файла с тестами должно совпадать с тем, что они тестируют.

**Пример:**

table.tsx -> table.test.tsx

#### Shared сегменты

В shared слое могут быть следующие shared сегменты:

- ui - для различных ui-kit-ов и подобных shared библиотек;
- utils - содержит shared библиотеки с утилитами и утилитарными хуками;
- constants - содержит файлы с глобальными константами;
- api - содержит shared библиотеки с общими запросами;
- config - для различных глобальных конфигов (локаль, тема и подобное);
- types - для глобальных и общих типов клиента;
  - не содержит shared библиотек;
  - файлы с глобальными и общими типами клиента;
  - папки для группировки файлов;
  - index файл для реэкспорта типов клиента;

## Работа с index файлами

По работе с index файлами есть несколько важных правил:

1. У всех слайсов и shared библиотек должны быть index файлы.
2. У сегмента types и у сегмента dto должен быть index файл.
3. У любых других папок не должно быть index файлов.
4. В index файлах могут быть только реэкспорты и ничего больше.

## Правила импортов и экспортов

Все правила импортов из FSD должны соблюдаться, однако также есть и дополнительные.

**Дополнительные правила:**

1. В слое shared у shared сегментов есть свои правила импортов:
   types -> constants -> utils -> config -> api -> ui
   (где types -> constants означает, что из types можно импортировать в
   constants, utils, config, api, ui и в любой слой выше, обратно - нет).
2. Внутри shared constants, types, или dto можно импортировать из файла в файл.
3. В shared utils можно импортировать константы из shared constants.

---

4. Все внутренние импорты в слайсе или shared библиотеке должны быть относительными и не через index файл.
5. Все импорты в слайс или shared библиотеку извне должны быть абсолютными и использовать alias-ы.
6. Все, что импортируется из слайса или shared библиотеки (которые не состоят из одного файла),
   должно импортироваться через index файл этого слайса или shared библиотеки (кроме типов).
7. В слое app нет ограничений на внутренние импорты.

---

8. Все типы должны изначально быть доступными для экспорта
   (должно быть ключевое слово export перед типом).
9. Все внутренние импорты в types или в dto должны быть относительными и не через index файл.
10. Каждый тип должен импортироваться в слайс или в shared библиотеку **ТОЛЬКО** через index файл своей папки types или dto.
11. Типы из dto можно импортировать **ТОЛЬКО** в сегмент api (в **ЛЮБОЙ**).

---

12. Нельзя использовать export default, export \*, import \*.
13. Если в index файле папки types или dto нужно реэкспортировать обычные типы и enum-ы из одного файла,
    то нужно это делать двумя разными строками кода:
    import type { ваши типы } from './файл';
    import { ваши enum-ы } from './файл';
